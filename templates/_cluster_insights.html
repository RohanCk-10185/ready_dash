<!-- Analysis & Insights Tab -->
<div id="insights" class="tab-content">
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #insights.fade-in {
            animation: fadeIn 0.2s ease-in-out;
        }
    </style>

    <div class="widget">
        <div class="widget-header"><h2><i data-feather="shield"></i> Security Best Practices</h2></div>
        <div class="widget-content" style="padding:0;">
            {% if cluster.security_insights %}
            <div class="table-container">
                <table class="data-table security-table">
                     <thead><tr><th>Check</th><th>Status</th><th>Details</th></tr></thead>
                     <tbody>
                        {% for key, insight in cluster.security_insights.items() if key != 'logging_enabled' %}
                        <tr>
                            <td>{{ insight.description }}</td>
                            <td style="text-align: center;">
                                {% if key == 'endpoint_access' %}
                                    <span class="status-badge status-{{ 'active' if insight.status == 'Passing' else 'failed' }}">
                                        {{ insight.status }}
                                    </span>
                                {% else %}
                                    <span class="status-badge status-{{ 'active' if insight.status else 'failed' }}">
                                        {{ 'Passing' if insight.status else 'Attention' }}
                                    </span>
                                {% endif %}
                            </td>
                            <td class="text-secondary">
                                {% if key == 'latest_platform_version' and not insight.status %}
                                    Current: {{ insight.current }}, Latest: {{ insight.latest }}
                                {% elif key == 'endpoint_access' %}
                                    {% if insight.access_type == 'Private' %}
                                        Endpoint Access is Private
                                    {% elif insight.access_type == 'Public' %}
                                        Endpoint Access is Public
                                    {% elif insight.access_type == 'Public and Private' %}
                                        Endpoint Access is Public
                                    {% else %}
                                        Endpoint Access is {{ insight.access_type }}
                                    {% endif %}
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                     </tbody>
                </table>
            </div>
            {% else %}
            <p class="text-muted" style="text-align:center; padding: 2rem;">
                Security insights could not be generated for this cluster.
            </p>
            {% endif %}
        </div>
    </div>

    <div class="widget">
        <div class="widget-header"><h2><i data-feather="align-left"></i> Control Plane Logging</h2></div>
        <div class="widget-content">
            {% if cluster.security_insights and cluster.security_insights.logging_enabled %}
                {% set logging_info = cluster.security_insights.logging_enabled %}
                <ul class="log-status-list">
                {% for log_type in logging_info.all_logs %}
                    <li class="log-status-item">
                        <span class="log-name">{{ log_type | title }}</span>
                        {% if log_type in logging_info.enabled_logs %}
                            <span class="status-badge status-active">Enabled</span>
                        {% else %}
                            <span class="status-badge status-failed">Disabled</span>
                        {% endif %}
                    </li>
                {% endfor %}
                </ul>
            {% else %}
            <p class="text-muted" style="text-align:center;">
                Logging status information is not available.
            </p>
            {% endif %}
        </div>
    </div>
</div>

<script>
    window.addEventListener('load', () => {
        const tab = document.getElementById('insights');
        if (tab) {
            tab.classList.add('fade-in');
        }
    });
</script>
